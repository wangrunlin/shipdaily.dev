---
export interface Props {
  title: string;
  description?: string;
  image?: string;
  keywords?: string;
  author?: string;
  type?: string;
}

const {
  title,
  description = "shipdaily.dev - 个人 Build in Public 展示网站 + 开发者每日 Ship 社区。记录 wangrunlin 的每日编程挑战，展示项目进展，分享学习心得。",
  image = "https://shipdaily.dev/og-image.png",
  keywords = "shipdaily,每日编程,Build in Public,开发者社区,GitHub,编程挑战,技术分享,wangrunlin",
  author = "wangrunlin",
  type = "website",
} = Astro.props;

const canonicalURL = new URL(Astro.url.pathname, Astro.site);

import "../styles/global.css";
---

<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content={Astro.generator} />

    <!-- SEO Meta Tags -->
    <title>{title}</title>
    <meta name="description" content={description} />
    <meta name="keywords" content={keywords} />
    <meta name="author" content={author} />
    <meta name="robots" content="index, follow" />
    <link rel="canonical" href={canonicalURL} />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content={type} />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={image} />
    <meta property="og:site_name" content="shipdaily.dev" />
    <meta property="og:locale" content="zh_CN" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content={canonicalURL} />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={image} />
    <meta name="twitter:creator" content="@wangrunlin_" />

    <!-- Additional SEO -->
    <meta name="theme-color" content="#2563eb" />
    <meta name="msapplication-TileColor" content="#2563eb" />
    <meta name="application-name" content="shipdaily.dev" />

    <!-- Structured Data -->
    <script type="application/ld+json" is:inline>
      {
        "@context": "https://schema.org",
        "@type": "Person",
        "name": "wangrunlin",
        "url": "https://shipdaily.dev",
        "image": "https://shipdaily.dev/og-image.png",
        "sameAs": [
          "https://twitter.com/wangrunlin_",
          "https://github.com/wangrunlin"
        ],
        "jobTitle": "Developer",
        "worksFor": {
          "@type": "Organization",
          "name": "Independent"
        },
        "description": "每日编程挑战者，Build in Public 实践者，开源项目贡献者"
      }
    </script>

    <!-- Performance optimizations -->
    <link rel="dns-prefetch" href="//api.github.com" />
    <link rel="dns-prefetch" href="//twitter.com" />
    <link rel="dns-prefetch" href="//x.com" />
    <link rel="dns-prefetch" href="//stats.alin.run" />
    <link rel="preconnect" href="https://api.github.com" crossorigin />
    <link rel="preconnect" href="https://twitter.com" crossorigin />
    <link rel="preconnect" href="https://stats.alin.run" crossorigin />

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="manifest" href="/site.webmanifest" />

    <!-- 内联关键 CSS -->
    <style is:inline>
      /* 关键路径 CSS - 首屏渲染优化 */
      .hero-section {
        min-height: 60vh;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      /* 防止布局偏移 */
      .loading-placeholder {
        min-height: 2rem;
        background: linear-gradient(
          90deg,
          #f3f4f6 25%,
          #e5e7eb 50%,
          #f3f4f6 75%
        );
        background-size: 200% 100%;
        animation: skeleton-loading 1.5s infinite;
      }

      @keyframes skeleton-loading {
        0% {
          background-position: 200% 0;
        }
        100% {
          background-position: -200% 0;
        }
      }

      /* 优化字体加载 */
      body {
        font-display: swap;
      }

      /* 可访问性辅助类 */
      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }

      .focus\:not-sr-only:focus {
        position: static;
        width: auto;
        height: auto;
        padding: 0.5rem 1rem;
        margin: 0;
        overflow: visible;
        clip: auto;
        white-space: normal;
      }

      /* 高对比度模式支持 */
      @media (prefers-contrast: high) {
        .bg-white {
          background-color: #ffffff;
          color: #000000;
        }
        .text-gray-600 {
          color: #333333;
        }
      }

      /* 减少动画模式支持 */
      @media (prefers-reduced-motion: reduce) {
        * {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
        }
      }

      /* 触摸反馈 */
      .touch-active {
        opacity: 0.7;
        transform: scale(0.98);
      }

      /* iOS Safari 视窗高度修复 */
      .ios-vh-fix {
        height: 100vh;
        height: calc(var(--vh, 1vh) * 100);
      }

      /* 小屏幕优化 */
      .small-screen .text-4xl {
        font-size: 2rem;
      }

      .small-screen .text-5xl {
        font-size: 2.5rem;
      }

      .small-screen .px-4 {
        padding-left: 0.75rem;
        padding-right: 0.75rem;
      }

      /* 慢网络优化 */
      .slow-network img {
        background-color: #f3f4f6;
      }

      .slow-network .transition-all {
        transition: none;
      }
    </style>

    <!-- Plausible Analytics -->
    <script
      is:inline
      defer
      data-domain="shipdaily.dev"
      src="https://stats.alin.run/js/script.file-downloads.hash.outbound-links.pageview-props.revenue.tagged-events.js"
    ></script>
    <script is:inline>
      window.plausible =
        window.plausible ||
        function () {
          (window.plausible.q = window.plausible.q || []).push(arguments);
        };
    </script>
  </head>

  <body class="min-h-screen bg-white antialiased">
    <!-- Skip to main content for screen readers -->
    <a
      href="#main-content"
      class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 bg-blue-600 text-white px-4 py-2 rounded-md z-50"
    >
      跳转到主要内容
    </a>
    <!-- Header -->
    <header
      class="sticky top-0 z-50 bg-white/80 backdrop-blur-md border-b border-gray-200/60"
    >
      <nav class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-14">
          <div class="flex items-center">
            <a
              href="/"
              class="flex items-center space-x-3"
              aria-label="shipdaily.dev 首页"
            >
              <div
                class="w-8 h-8 rounded-lg bg-gray-900 text-white flex items-center justify-center text-sm font-semibold"
                aria-hidden="true"
              >
                🚢
              </div>
              <span class="text-base font-semibold text-gray-900"
                >shipdaily.dev</span
              >
            </a>
          </div>

          <nav
            class="hidden md:flex items-center space-x-1"
            role="navigation"
            aria-label="主导航"
          >
            <a
              href="/"
              class="px-3 py-2 text-sm font-medium text-gray-900 hover:text-gray-600 rounded-md transition-colors"
              aria-current={Astro.url.pathname === "/" ? "page" : undefined}
              >首页</a
            >
            <a
              href="/about"
              class="px-3 py-2 text-sm font-medium text-gray-600 hover:text-gray-900 rounded-md transition-colors"
              aria-current={Astro.url.pathname === "/about"
                ? "page"
                : undefined}>关于</a
            >
            <a
              href="/community"
              class="px-3 py-2 text-sm font-medium text-gray-600 hover:text-gray-900 rounded-md transition-colors"
              aria-current={Astro.url.pathname === "/community"
                ? "page"
                : undefined}>社区</a
            >
            <a
              href="/me"
              class="px-3 py-2 text-sm font-medium text-gray-600 hover:text-gray-900 rounded-md transition-colors"
              aria-current={Astro.url.pathname === "/me" ? "page" : undefined}
              >动态</a
            >
            <a
              href="/contact"
              class="px-3 py-2 text-sm font-medium text-gray-600 hover:text-gray-900 rounded-md transition-colors"
              aria-current={Astro.url.pathname === "/contact"
                ? "page"
                : undefined}>联系</a
            >
          </nav>

          <!-- Mobile menu button -->
          <div class="md:hidden">
            <button
              id="mobile-menu-button"
              class="p-2 text-gray-600 hover:text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 rounded-md"
              aria-expanded="false"
              aria-controls="mobile-menu"
              aria-label="打开主菜单"
            >
              <svg
                class="h-5 w-5"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
                stroke-width="2"
                aria-hidden="true"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M4 6h16M4 12h16M4 18h16"></path>
              </svg>
            </button>
          </div>
        </div>
      </nav>
    </header>

    <!-- Mobile menu (hidden by default) -->
    <div
      id="mobile-menu"
      class="md:hidden hidden"
      role="navigation"
      aria-label="移动端导航"
    >
      <div
        class="px-2 pt-2 pb-3 space-y-1 sm:px-3 bg-white border-b border-gray-200"
      >
        <a
          href="/"
          class="block px-3 py-2 text-sm font-medium text-gray-900 hover:text-gray-600 rounded-md transition-colors"
          aria-current={Astro.url.pathname === "/" ? "page" : undefined}>首页</a
        >
        <a
          href="/about"
          class="block px-3 py-2 text-sm font-medium text-gray-600 hover:text-gray-900 rounded-md transition-colors"
          aria-current={Astro.url.pathname === "/about" ? "page" : undefined}
          >关于</a
        >
        <a
          href="/community"
          class="block px-3 py-2 text-sm font-medium text-gray-600 hover:text-gray-900 rounded-md transition-colors"
          aria-current={Astro.url.pathname === "/community"
            ? "page"
            : undefined}>社区</a
        >
        <a
          href="/me"
          class="block px-3 py-2 text-sm font-medium text-gray-600 hover:text-gray-900 rounded-md transition-colors"
          aria-current={Astro.url.pathname === "/me" ? "page" : undefined}
          >动态</a
        >
        <a
          href="/contact"
          class="block px-3 py-2 text-sm font-medium text-gray-600 hover:text-gray-900 rounded-md transition-colors"
          aria-current={Astro.url.pathname === "/contact" ? "page" : undefined}
          >联系</a
        >
      </div>
    </div>

    <!-- Main Content -->
    <main id="main-content" tabindex="-1">
      <slot />
    </main>

    <!-- Footer -->
    <footer class="border-t border-gray-100 mt-20">
      <div class="max-w-6xl mx-auto py-16 px-4 sm:px-6 lg:px-8">
        <div class="grid grid-cols-2 md:grid-cols-4 gap-8">
          <div>
            <h3
              class="text-xs font-semibold text-gray-900 tracking-wider uppercase mb-4"
            >
              产品
            </h3>
            <ul class="space-y-3">
              <li>
                <a
                  href="/about"
                  class="text-sm text-gray-600 hover:text-gray-900 transition-colors"
                  >关于 ShipDaily</a>
              </li>
              <li>
                <a
                  href="/community"
                  class="text-sm text-gray-600 hover:text-gray-900 transition-colors"
                  >社区动态</a>
              </li>
              <li>
                <a
                  href="/me"
                  class="text-sm text-gray-600 hover:text-gray-900 transition-colors"
                  >我的动态</a>
              </li>
            </ul>
          </div>

          <div>
            <h3
              class="text-xs font-semibold text-gray-900 tracking-wider uppercase mb-4"
            >
              社区
            </h3>
            <ul class="space-y-3">
              <li>
                <a
                  href="https://twitter.com/hashtag/shipdaily"
                  class="text-sm text-gray-600 hover:text-gray-900 transition-colors"
                  target="_blank">#shipdaily</a>
              </li>
              <li>
                <a
                  href="https://github.com/wangrunlin/shipdaily.dev"
                  class="text-sm text-gray-600 hover:text-gray-900 transition-colors"
                  target="_blank">GitHub</a>
              </li>
            </ul>
          </div>

          <div>
            <h3
              class="text-xs font-semibold text-gray-900 tracking-wider uppercase mb-4"
            >
              联系
            </h3>
            <ul class="space-y-3">
              <li>
                <a
                  href="https://x.com/wangrunlin_"
                  class="text-sm text-gray-600 hover:text-gray-900 transition-colors"
                  target="_blank">X / Twitter</a>
              </li>
              <li>
                <a
                  href="https://github.com/wangrunlin"
                  class="text-sm text-gray-600 hover:text-gray-900 transition-colors"
                  target="_blank">GitHub</a>
              </li>
              <li>
                <a
                  href="/contact"
                  class="text-sm text-gray-600 hover:text-gray-900 transition-colors"
                  >联系方式</a>
              </li>
            </ul>
          </div>

          <div>
            <h3
              class="text-xs font-semibold text-gray-900 tracking-wider uppercase mb-4"
            >
              资源
            </h3>
            <ul class="space-y-3">
              <li>
                <a
                  href="https://docs.github.com/en/rest"
                  class="text-sm text-gray-600 hover:text-gray-900 transition-colors"
                  target="_blank">GitHub API</a>
              </li>
              <li>
                <a
                  href="https://astro.build"
                  class="text-sm text-gray-600 hover:text-gray-900 transition-colors"
                  target="_blank">Astro</a>
              </li>
            </ul>
          </div>
        </div>

        <div
          class="mt-12 pt-8 border-t border-gray-100 flex flex-col md:flex-row justify-between items-center"
        >
          <div class="flex items-center space-x-4 mb-4 md:mb-0">
            <div
              class="w-6 h-6 rounded bg-gray-900 text-white flex items-center justify-center text-xs font-semibold"
            >
              🚢
            </div>
            <span class="text-sm text-gray-600">© 2025 shipdaily.dev</span>
          </div>
          <p class="text-sm text-gray-600">Built with ❤️ by wangrunlin</p>
        </div>
      </div>
    </footer>

    <!-- Mobile menu accessibility script -->
    <script is:inline>
      document.addEventListener("DOMContentLoaded", () => {
        const mobileMenuButton = document.getElementById("mobile-menu-button");
        const mobileMenu = document.getElementById("mobile-menu");

        if (mobileMenuButton && mobileMenu) {
          let isMenuOpen = false;

          mobileMenuButton.addEventListener("click", () => {
            isMenuOpen = !isMenuOpen;

            // Toggle menu visibility
            if (isMenuOpen) {
              mobileMenu.classList.remove("hidden");
              mobileMenuButton.setAttribute("aria-expanded", "true");
              mobileMenuButton.setAttribute("aria-label", "关闭主菜单");
            } else {
              mobileMenu.classList.add("hidden");
              mobileMenuButton.setAttribute("aria-expanded", "false");
              mobileMenuButton.setAttribute("aria-label", "打开主菜单");
            }
          });

          // Close menu when clicking outside
          document.addEventListener("click", (e) => {
            if (
              !mobileMenuButton.contains(e.target) &&
              !mobileMenu.contains(e.target)
            ) {
              if (isMenuOpen) {
                mobileMenu.classList.add("hidden");
                mobileMenuButton.setAttribute("aria-expanded", "false");
                mobileMenuButton.setAttribute("aria-label", "打开主菜单");
                isMenuOpen = false;
              }
            }
          });

          // Close menu on Escape key
          document.addEventListener("keydown", (e) => {
            if (e.key === "Escape" && isMenuOpen) {
              mobileMenu.classList.add("hidden");
              mobileMenuButton.setAttribute("aria-expanded", "false");
              mobileMenuButton.setAttribute("aria-label", "打开主菜单");
              mobileMenuButton.focus();
              isMenuOpen = false;
            }
          });
        }
      });
    </script>
  </body>
</html>
